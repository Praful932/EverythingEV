{% extends "userapp/layout.html" %} {% load static %} 
{% block head %}
  <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>
<link rel='stylesheet' href='https://npmcdn.com/flickity@2/dist/flickity.css'>
<link rel="stylesheet" href="{%  static 'userapp/complaint_style.css' %}">
{% endblock %}

{% block body %}
<p style="margin-top: 50px;"></p>
<body style="background-image: linear-gradient(#62C3C8, #37B9E9);"></body>
<div class="container-fluid"> 
  <div class="row">
    <div class="col-sm-4">
      <div class="card">
        <div class="card-body" id="Row1">
          <h3 class="card-title">Pending Complaints</h3>
          <p class="card-text" style="font-size:6em;text-align:center;margin-top:-20px">{{count}}</p>
        </div>
      </div>
    </div>
        <div class="col-sm-4">
      <div class="card">
        <div class="card-body" id="Row1">
          <h3 class="card-title">Complaints Solved</h3>
          <p class="card-text" style="font-size:6em;text-align:center;margin-top:-20px">{{m.CompletedComplaints}}</p>
        </div>
      </div>
    </div>
    <div class="col-sm-4">
      <div class="card">
        <div class="card-body" id="Row1">
          <h3 class="card-title">Total Complaints</h3>
          <p class="card-text" style="font-size:6em;text-align:center;margin-top:-20px">{{total}}</p>
        </div>
      </div>
    </div>
    <div class="col-sm-12">
      <!-- <div class="table-wrapper-scroll-y my-custom-scrollbar"> -->

      <table class="table" id="Row2">
              <div class="table-wrapper-scroll-y my-custom-scrollbar">

        <p>Pending Complaint Details</p>
        <thead class="thead-dark">
          <tr>
            <th scope="col">Id</th>
            <th scope="col">ChargingStation Name</th>
            <th scope="col">Details</th>
            <th scope="col">Contact No.</th>
            <th scope="col">To Visit</th>
          </tr>
        </thead>
        <tbody>
          {%for a in d%}
          <tr>
            <th scope="row">{{a.CsSelect.id}}</th>
            <td>{{a.CsSelect.name}}</td>
            <td><details>
              <summary>Complaint</summary>
              <b>Problem</b>
              <p>{{a.Problem}}</p>
              <b>Address</b>
              <p>{{a.CsSelect.suburb}}</p>
              </details></td>
            <td>{{a.ph}}</td>
            <form action="" method="POST">
              {% csrf_token %}
            <td><button type="submit" value="{{a.pk}}" name="visited" class="btn btn-success">Visited</button>
            </td>
    
              </form>
          </tr>
          {%endfor%}
          
        </tbody>
      </table>
    </div>
    <!--map-->
    <b>Checkout the Locations......</b><br>
    <div id="new">
                  
    </div>
    <div class="col-sm-12">
      <div class="container">
        <div class="main">
          <div class="row">
            <div class="col-sm-2">
              <ul class="nav nav-tabs" id="myTab">
              
                              
              </ul>
              <div class="tab-content">
                
              </div>
            </div>
            
            <div class="col-sm-10">
              <div id="map_canvas" style="height:250px; border: thin solid black;"></div>
            </div>
          </div>
        </div>
      </div>
      <br>
    </div>  <!--map end-->
    

   <div class="col-sm-12">
      <div class="carousel" data-flickity='{ "groupCells": true }'>
        {%for ad in d%}
        <div class="carousel-cell"><p>{{ad.CsSelect.id}}.{{ad.CsSelect.name}}<br>Locality..{{ad.CsSelect.suburb}}<br>Ports available...{{ad.CsSelect.no_of_ports}}<br>Timings..{{ad.CsSelect.opening_time}}-{{ad.CsSelect.closing_time}}</p></div>
        {%endfor%}
      </div>
    </div>
  </div>
</div>
<!-- partial -->
  <script src='https://npmcdn.com/flickity@2/dist/flickity.pkgd.js'></script>
  <script src='https://maps.googleapis.com/maps/api/js'></script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9Y9_KDeiRBLZorVqObm42FaX_XnAxJoY&callback=initMap">
    </script>

{% endblock body %}
{%block script%}
<script>

  var marker;
  var map;
  var my_data = JSON.parse('{{ my_data|safe }}');
  console.log(my_data[0][2]); 
  
  for (var i = 0 ; i < my_data.length; i++) {
  
          var str1="#link";
          var str2=i;
          var a = document.createElement("a");
          var text = document.createTextNode(my_data[i][2]+" "+my_data[i][3]+"     .     .");
          a.appendChild(text);
         // a.href="#rnd";
          a.id=str1.concat(str2);
          var x=my_data[i][0];
          var y=my_data[i][1];
          var passfoo = "myFunction(" + x + "," + y + ")";
          a.setAttribute("onclick", passfoo);
          a.setAttribute("data-toggle", "tab");
          var element = document.getElementById("new");
          element.appendChild(a);
        
  }  


    function myFunction(x,y) {
      changeMarkerPos(x,y);
    }

  
  function initialize() {
      var styles = [{
          stylers: [{
              saturation: -100
          }]
      }];
      var styledMap = new google.maps.StyledMapType(styles, {
          name: "Styled Map"
      });
      var mapProp = {
          center: new google.maps.LatLng(19.261522, 75.194100),
          zoom: 13,
          panControl: false,
          zoomControl: false,
          mapTypeControl: false,
          scaleControl: true,
          streetViewControl: false,
          overviewMapControl: false,
          rotateControl: true,
          scrollwheel: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById("map_canvas"), mapProp);
    
      map.mapTypes.set('map_style', styledMap);
      map.setMapTypeId('map_style')
  
      marker = new google.maps.Marker({
          position: new google.maps.LatLng(19.261522, 75.194100),
          animation: google.maps.Animation.DROP,
          icon: 'https://cdn2.iconfinder.com/data/icons/flat-ui-icons-24-px/24/location-24-32.png',
      });
    
      marker.setMap(map);
      map.panTo(marker.position);
  }
  
  function changeMarkerPos(lat, lon){
      myLatLng = new google.maps.LatLng(lat, lon)
      marker.setPosition(myLatLng);
      map.panTo(myLatLng);
  }
  
  google.maps.event.addDomListener(window, 'load', initialize);

</script>

{%endblock%}